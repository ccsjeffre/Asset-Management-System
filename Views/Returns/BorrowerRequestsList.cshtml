@model List<Asset_Management_System.Models.Borrower>

@{
    ViewData["Title"] = "Returning";
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
}

<main class="main-content" id="main-content">
    <h2 class="text-center text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Returning</h2>

    <section class="bg-white p-4 rounded-lg shadow ring-1 ring-gray-300">
        <div class="overflow-x-auto">
            <table class="min-w-full text-sm border border-gray-300">
                <thead class="bg-gray-100 text-xs font-semibold text-gray-600">
                    <tr>
                        <th class="p-3 border text-left">Borrowed Item Info</th>
                        <th class="p-3 border text-left">Status</th>
                        <th class="p-3 border text-left">Received By</th>
                        <th class="p-3 border text-left">Date Returned</th>
                        <th class="p-3 border text-left">Confirm</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var borrower in Model.Where(b => b.BorrowStatus == "Approved"))
                    {
                        <form asp-action="ReturnHardware" asp-controller="Borrowers" asp-route-id="@borrower.BorrowersId" method="post">
                            @Html.AntiForgeryToken()
                        <tr class="hover:bg-gray-50 border-b">
                            <!-- Borrowed Item Info -->
                            <td class="p-3 border">
                                <div class="font-semibold">Name: @borrower.BorrowersName</div>
                                <div class="font-semibold text-sm text-gray-600">Department: @borrower.Department</div>
                                    @foreach (var bh in borrower.BorrowedHardwares)
                                    {
                                    <div class="text-sm">
                                        • @bh.Hardware?.HardType - Sticker #@bh.Hardware?.HardStickerNum
                                    </div>
                                    }
                            </td>

                            <!-- Status Dropdown -->
                            <td class="p-3 border">
                                    @foreach (var bh in borrower.BorrowedHardwares)
                                    {
                                    <div class="mb-1">
                                        <label class="text-xs font-semibold block mb-0.5">
                                                @bh.Hardware?.HardType - @bh.Hardware?.HardStickerNum
                                        </label>
                                        <select name="ReturnedStatuses[]" class="w-full border rounded px-2 py-1 text-sm">
                                            <option value="Functional">Functional</option>
                                            <option value="Defective">Defective</option>
                                        </select>
                                    </div>
                                    }
                            </td>

                            <!-- Received By -->
                            <td class="p-3 border">
                                <input type="text" name="ReceivedBy"
                                       value="@borrower.ReceivedBy"
                                       class="w-full border px-2 py-1 text-sm rounded" />
                            </td>

                            <!-- Date Returned -->
                            <td class="p-3 border">
                                <input type="date" name="ReturnOn"
                                       value="@borrower.ReturnOn?.ToString("yyyy-MM-dd")"
                                       class="w-full border px-2 py-1 text-sm rounded" />
                            </td>

                            <!-- Confirm Button -->
                            <td class="p-3 border">
                                <button type="submit"
                                        class="text-xs px-3 py-1 border border-indigo-500 text-indigo-500 hover:bg-indigo-500 hover:text-white rounded transition">
                                    CONFIRM RETURN
                                </button>
                            </td>
                        </tr>
                        </form>
                    }
                </tbody>
            </table>
        </div>
    </section>
</main>
